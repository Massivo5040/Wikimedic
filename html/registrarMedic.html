<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Medicamentos</title>

    <link rel="stylesheet" href="../css/registrar.css" />
</head>

<body>

    <h1>Validar Registro de Medicamento</h1>

    <form id="medicationForm">

        <div class="form-head">
            <label for="categoria">Categoria:</label>
            <select id="categoria" name="categoria" required>
                <option value="populares">Populares</option>
                <option value="genéricos">Genéricos</option>
                <option value="pediátricos">Pediátricos</option>
                <option value="fitoterápicos">Fitoterápicos</option>
                <option value="homepáticos">Homeopáticos</option>
                <option value="similares">Similares</option>
                <option value="alopáticos">Alopáticos</option>

            </select>

            <label for="numRegistro">Número de Registro:</label>
            <input type="text" id="numRegistro" name="numRegistro" required><br>
        </div>


        <label for="name">Nome:</label>
        <input type="text" id="name" name="name" required><br>

        <label for="indicacao">Indicação:</label>
        <textarea id="indicacao" name="indicacao" rows="4" required></textarea><br>

        <label for="contraindicacao">Contraindicação:</label>
        <textarea id="contraindicacao" name="contraindicacao" rows="4" required></textarea><br>

        <label for="cuidados">Cuidados:</label>
        <textarea id="cuidados" name="cuidados" rows="4" required></textarea><br>

        <label for="reacao_adversa">Reação Adversa:</label>
        <textarea id="reacao_adversa" name="reacao_adversa" rows="4" required></textarea><br>

        <label for="posologia">Posologia:</label>
        <textarea id="posologia" name="posologia" rows="4" required></textarea><br>

        <label for="riscos">Riscos:</label>
        <textarea id="riscos" name="riscos" rows="4" required></textarea><br>

        <label for="especiais">Pacientes Especiais:</label>
        <textarea id="especiais" name="especiais" rows="4" required></textarea><br>

        <label for="superdose">Superdose:</label>
        <textarea id="superdose" name="superdose" rows="4" required></textarea><br>

        <button type="button" id="registrar">Registrar Medicamento</button>
    </form>

    <h2>Consultar Medicamentos</h2>
    <table id="tableLoadMedic">
        <tr id="tableHead">
            <td>Name</td>
            <td>NumRegistro</td>
            <td>Categoria</td>
            <td>Link Wikimedic</td>
            <td>Actions</td>
        </tr>
    </table>

    <h1>Update Medicamentos</h1>

    <form id="medicationForm">
        <p id="medSelected"></p>

        <div class="form-head">
            <label for="update-categoria">Categoria:</label>
            <select id="update-categoria" name="categoria" required>
                <option value="populares">Populares</option>
                <option value="genéricos">Genéricos</option>
                <option value="pediátricos">Pediátricos</option>
                <option value="fitoterápicos">Fitoterápicos</option>
                <option value="homepáticos">Homeopáticos</option>
                <option value="similares">Similares</option>
                <option value="alopáticos">Alopáticos</option>

            </select>

            <label for="update-numRegistro">Número de Registro:</label>
            <input type="text" id="update-numRegistro" name="numRegistro" required><br>
        </div>

        <label for="update-name">Nome:</label>
        <input type="text" id="update-name" name="update-"><br>

        <label for="update-indicacao">Indicação:</label>
        <textarea id="update-indicacao" name="update-indicacao" rows="4"></textarea><br>

        <label for="update-contraindicacao">Contraindicação:</label>
        <textarea id="update-contraindicacao" name="update-contraindicacao" rows="4"></textarea><br>

        <label for="update-cuidados">Cuidados:</label>
        <textarea id="update-cuidados" name="update-cuidados" rows="4"></textarea><br>

        <label for="update-reacao_adversa">Reação Adversa:</label>
        <textarea id="update-reacao_adversa" name="update-reacao_adversa" rows="4"></textarea><br>

        <label for="update-posologia">Posologia:</label>
        <textarea id="update-posologia" name="update-posologia" rows="4"></textarea><br>

        <label for="update-riscos">Riscos:</label>
        <textarea id="update-riscos" name="update-riscos" rows="4"></textarea><br>

        <label for="update-especiais">Especiais:</label>
        <textarea id="update-especiais" name="update-especiais" rows="4"></textarea><br>

        <button type="button" id="atualizar">Atualizar Medicamento</button>
    </form>



    <script>
        let numRegistroNow = ''
        async function registerMedication() {
            const medicationData = {
                name: document.getElementById('name').value,
                numRegistro: document.getElementById('numRegistro').value,
                indicacao: document.getElementById('indicacao').value,
                contraindicacao: document.getElementById('contraindicacao').value,
                categoria: document.getElementById('categoria').value,
                cuidados: document.getElementById('cuidados').value,
                reacao_adversa: document.getElementById('reacao_adversa').value,
                posologia: document.getElementById('posologia').value,
                riscos: document.getElementById('riscos').value,
                especiais: document.getElementById('especiais').value,
                superdose: document.getElementById('superdose').value
            };

            const response = await fetch('https://server-wikimedic.onrender.com/medicamentos/validate', {
                method: 'POST',
                headers: {
                    'Content-type': 'application/json; charset=UTF-8',
                },
                body: JSON.stringify(medicationData),
            });

            if (response.ok) {
                console.log('Sucesso');
                const json = await response.json()
                console.log(json)
                alert('Sucesso. ' + json.validacao_status)
            } else {
                console.log('Algo deu errado');
            }
        }
        document.querySelector('#registrar').addEventListener('click', registerMedication)

        async function updateMedic() {
            const medicationData = {
                numRegistro: document.getElementById('update-numRegistro').value,
                newMedic: {
                    name: document.getElementById('update-name').value,
                    numRegistro: document.getElementById('update-numRegistro').value,
                    indicacao: document.getElementById('update-indicacao').value,
                    contraindicacao: document.getElementById('update-contraindicacao').value,
                    categoria: document.getElementById('update-categoria').value,
                    cuidados: document.getElementById('update-cuidados').value,
                    reacao_adversa: document.getElementById('update-reacao_adversa').value,
                    posologia: document.getElementById('update-posologia').value,
                    riscos: document.getElementById('update-riscos').value,
                    especiais: document.getElementById('update-especiais').value,
                }
            };

            const response = await fetch('https://server-wikimedic.onrender.com/medicamentos/update', {
                method: 'POST',
                headers: {
                    'Content-type': 'application/json; charset=UTF-8',
                },
                body: JSON.stringify(medicationData),
            });

            if (response.ok) {
                console.log('Sucesso');
                const json = await response.json()
                console.log(json)
                alert('Sucesso. ')
                document.querySelector('#medSelected').textContent = `Nenhum Medicamento Selecionado`
                document.querySelector('#update-name').value = ""
                document.querySelector('#update-numRegistro').value = ""
                document.querySelector('#update-categoria').value = "populares"
                document.querySelector('#update-indicacao').value = ""
                document.querySelector('#update-contraindicacao').value = ""
                document.querySelector('#update-reacao_adversa').value = ""
                document.querySelector('#update-posologia').value = ""
                document.querySelector('#update-riscos').value = ""
                document.querySelector('#update-especiais').value = ""
            } else {
                console.log('Algo deu errado');
                console.log(await response.json())
                alert('Algo deu Errado!!.')
            }
        }
        document.querySelector('#atualizar').addEventListener('click', updateMedic);

        (async () => {
            const response = await fetch('https://server-wikimedic.onrender.com/medicamentos');
            if (response.ok) {
                const json = await response.json()
                console.log(json)
                json.forEach(i => {
                    const link = `https://massivo5040.github.io/Wikimedic/html/medic.html?numRegistro=${i.numRegistro}`
                    let categoria = i.categoria.toUpperCase()

                    const tr = document.createElement('tr')
                    const tdName = document.createElement('td')
                    tdName.textContent = i.name
                    const tdCategoria = document.createElement('td')
                    tdCategoria.textContent = categoria
                    const tdNumRegistro = document.createElement('td')
                    tdNumRegistro.textContent = i.numRegistro

                    const tdLink = document.createElement('td')
                    const a = document.createElement('a')
                    a.href = link
                    a.textContent = i.name 
                    tdLink.appendChild(a)

                    const tdButton = document.createElement('td')
                    const button = document.createElement('td')
                    tdButton.appendChild(button)

                    button.textContent = "Update"
                    button.addEventListener('click', () => {
                        document.querySelector('#medSelected').textContent = `Medicamento Selecionado: ${i.name}. Número Registro salvo: ${i.numRegistro}`
                        document.querySelector('#update-name').value = i.name
                        document.querySelector('#update-numRegistro').value = i.numRegistro
                        document.querySelector('#update-categoria').value = i.categoria
                        document.querySelector('#update-indicacao').value = i.indicacao
                        document.querySelector('#update-contraindicacao').value = i.contraindicacao
                        document.querySelector('#update-reacao_adversa').value = i.reacao_adversa
                        document.querySelector('#update-posologia').value = i.posologia
                        document.querySelector('#update-riscos').value = i.riscos
                        document.querySelector('#update-especiais').value = i.especiais

                        alert('Vá até o formulário de atualização')
                    })

                    tr.appendChild(tdName)
                    tr.appendChild(tdNumRegistro)
                    tr.appendChild(tdCategoria)
                    tr.appendChild(tdLink)
                    tr.appendChild(tdButton)
                    document.querySelector('#tableLoadMedic').appendChild(tr)
                });
            }
        })()
    </script>

</body>

</html>